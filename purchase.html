<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>شراء الشهادة – Xlop</title>
  <link rel="stylesheet" href="styles.css">
  <script defer src="script.js"></script>
</head>
<body>
  <nav class="nav container">
    <div class="brand"><img src="assets/logo.svg" alt="Xlop"><strong>Xlop Certificates</strong></div>
    <div><a href="index.html">الرئيسية</a><a href="faq.html">الأسئلة الشائعة</a></div>
  </nav>

  <main class="container section">
    <h1>شراء الشهادة</h1>
    <p id="udidStatus" class="note">أدخل UDID يدويًا أو احصل عليه تلقائيًا من <a href="https://api.xlop.com/get-udid.php">هنا</a>.</p>
    <form class="card" style="max-width:560px">
      <label>البريد الإلكتروني</label>
      <input class="input" type="email" id="email" placeholder="you@example.com" required>
      <label>UDID</label>
      <input class="input" id="udid" name="udid" placeholder="XXXXXXXX-00008101" required>
      <label>الخطة</label>
      <select class="input" id="plan">
        <option value="year">سنة – 59 ر.س</option>
        <option value="2year">سنتين – 99 ر.س</option>
        <option value="dev">مطوّر – 139 ر.س</option>
      </select>

      <div class="note" style="margin-top:8px">بالضغط على الدفع، أنت توافق على الشروط وسياسة الخصوصية.</div>
      <div style="height:12px"></div>

      <!-- PayPal Smart Buttons placeholder -->
      <div id="paypal-button-container"></div>
      <div class="note">ملاحظة: تحتاج ربط PayPal Client ID في هذا الملف.</div>
    </form>
  </main>

  <footer class="footer container">© <span id="y"></span> Xlop</footer>
  <script>document.getElementById('y').textContent = new Date().getFullYear()</script>

  <!-- PayPal SDK (replace YOUR-CLIENT-ID) -->
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR-CLIENT-ID&currency=USD" data-sdk-integration-source="button-factory"></script>
  <script>
    // مبسّط: إنشاء طلب ثم الالتقاط (للتجربة فقط – يفضّل إجراء الـCapture من السيرفر)
    const planPrices = {year: 59, "2year": 99, dev: 139};
    function getPlan(){ return document.getElementById('plan').value || 'year'; }
    paypal.Buttons({
      createOrder: function(data, actions) {
        const plan = getPlan();
        const amount = planPrices[plan] || 59;
        return actions.order.create({
          purchase_units: [{
            description: "Xlop iOS Certificate ("+plan+")",
            amount: { value: amount.toString(), currency_code: "USD" }
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          const email = document.getElementById('email').value.trim();
          const udid  = document.getElementById('udid').value.trim();
          const plan  = getPlan();
          // TODO: أرسل هذه البيانات لسيرفرك لإصدار الشهادة
          const q = new URLSearchParams({status:"success", udid, email, plan, orderId: data.orderID}).toString();
          window.location.href = "success.html?"+q;
        });
      },
      onError: function(err){
        alert("حصل خطأ في الدفع: " + err);
      }
    }).render('#paypal-button-container');
  </script>
</body>
</html>
